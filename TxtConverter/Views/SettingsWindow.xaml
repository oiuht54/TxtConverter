<Window x:Class="TxtConverter.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None" ResizeMode="NoResize"
        Width="460" Height="680" 
        WindowStartupLocation="CenterOwner"
        Title="Settings" Background="{StaticResource Brush_WindowBg}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>
    <Border BorderBrush="#333333" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Title Bar -->
                <RowDefinition Height="*"/> <!-- Content -->
            </Grid.RowDefinitions>
            <!-- Title Bar -->
            <Grid Grid.Row="0" Background="{StaticResource Brush_WindowBg}" MouseDown="TitleBar_MouseDown" Height="40">
                <TextBlock Text="{DynamicResource ui_settings}" FontWeight="Bold" Foreground="#888888" Margin="15,0" VerticalAlignment="Center"/>
                <Button Style="{StaticResource CloseButton}" HorizontalAlignment="Right" Click="Close_Click" Content="X" WindowChrome.IsHitTestVisibleInChrome="True"/>
            </Grid>
            <!-- Main Layout -->
            <Grid Grid.Row="1" Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/> <!-- Scrollable Content -->
                    <RowDefinition Height="Auto"/> <!-- Footer/Button -->
                </Grid.RowDefinitions>
                
                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,10,0">
                    <StackPanel>
                        <!-- General Settings -->
                        <Border Style="{StaticResource CardBorder}" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource ui_settings_general}" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
                                
                                <TextBlock Text="{DynamicResource ui_settings_lang}" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                <ComboBox x:Name="LanguageCombo" SelectionChanged="LanguageCombo_SelectionChanged" HorizontalAlignment="Stretch" Margin="0,0,0,10"/>
                                
                                <CheckBox x:Name="TelemetryCb" Content="{DynamicResource ui_settings_telemetry}" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- AI Settings -->
                        <Border Style="{StaticResource CardBorder}" Margin="0,0,0,5">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource ui_settings_ai}" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
                                
                                <!-- Provider -->
                                <TextBlock Text="{DynamicResource ui_settings_provider}" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                <ComboBox x:Name="ProviderCombo" SelectionChanged="ProviderCombo_SelectionChanged" HorizontalAlignment="Stretch" Margin="0,0,0,10">
                                    <ComboBoxItem Content="Google Gemini" Tag="GoogleGemini"/>
                                    <ComboBoxItem Content="NVIDIA NIM" Tag="NvidiaNim"/>
                                </ComboBox>
                                
                                <!-- API Key -->
                                <TextBlock Text="{DynamicResource ui_settings_apikey}" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                <PasswordBox x:Name="ApiKeyBox" PasswordChar="•" 
                                             Background="#151515" Foreground="White" BorderBrush="#333333" BorderThickness="1"
                                             Padding="8,6" VerticalContentAlignment="Center" FontSize="14"
                                             PasswordChanged="ApiKeyBox_PasswordChanged"/>
                                <TextBlock x:Name="ApiKeyLink" Text="https://aistudio.google.com/app/apikey" FontSize="11" Foreground="#555555" Margin="0,2,0,10" Cursor="Hand" MouseDown="Link_MouseDown"/>

                                <!-- Model -->
                                <TextBlock Text="{DynamicResource ui_settings_model}" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="ModelCombo" IsEditable="True" Background="#151515" Foreground="White" BorderBrush="#444"/>
                                    <Button Grid.Column="1" Content="↻" Click="RefreshModels_Click" Width="30" Margin="5,0,0,0" ToolTip="Fetch models from API" Background="#333" BorderBrush="#555"/>
                                </Grid>

                                <!-- GEMINI SPECIFIC PANEL -->
                                <StackPanel x:Name="GeminiPanel" Visibility="Visible">
                                    <TextBlock Text="{DynamicResource ui_settings_thinking}" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox x:Name="ThinkingCb" Content="{DynamicResource ui_settings_enable_reasoning}" VerticalAlignment="Center"/>
                                    </Grid>
                                    <Grid IsEnabled="{Binding IsChecked, ElementName=ThinkingCb}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="{DynamicResource ui_settings_tokens}" Style="{StaticResource FieldLabel}" Margin="0,0,10,0"/>
                                        <TextBox x:Name="BudgetBox" Grid.Column="1" Text="24000"/>
                                    </Grid>
                                </StackPanel>

                                <!-- NVIDIA SPECIFIC PANEL -->
                                <StackPanel x:Name="NvidiaPanel" Visibility="Collapsed">
                                    <!-- Max Tokens -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Max Output Tokens:" Style="{StaticResource FieldLabel}" Margin="0,0,10,0"/>
                                        <TextBox x:Name="NvMaxTokensBox" Grid.Column="1" Text="4096"/>
                                    </Grid>

                                    <!-- Temperature -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Temperature (0.0 - 1.0):" Style="{StaticResource FieldLabel}" Margin="0,0,10,0"/>
                                        <TextBox x:Name="NvTempBox" Grid.Column="1" Text="0.5"/>
                                    </Grid>

                                    <!-- Top P -->
                                    <Grid Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Top P (0.0 - 1.0):" Style="{StaticResource FieldLabel}" Margin="0,0,10,0"/>
                                        <TextBox x:Name="NvTopPBox" Grid.Column="1" Text="0.7"/>
                                    </Grid>

                                    <!-- Reasoning Toggle -->
                                    <TextBlock Text="Reasoning (DeepSeek R1):" Margin="0,0,0,5" Foreground="{StaticResource Brush_Fg}"/>
                                    <CheckBox x:Name="NvReasoningCb" Content="Enable Thinking &amp; High Effort" Margin="0,0,0,10"
                                              ToolTip="Adds 'chat_template_kwargs: {thinking: true}' and 'effort: high' to request."/>
                                </StackPanel>

                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <Button Grid.Row="1" Content="{DynamicResource ui_settings_close}" 
                        HorizontalAlignment="Right" Width="100" 
                        Click="Close_Click" Style="{StaticResource AccentButton}"
                        Margin="0,20,0,0"/>
            </Grid>
        </Grid>
    </Border>
</Window>