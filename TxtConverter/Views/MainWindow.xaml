<Window x:Class="TxtConverter.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="{DynamicResource app_title}"
        Height="700" Width="680" MinHeight="650" MinWidth="600"
        WindowStyle="None" ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True" Drop="Window_Drop"
        Background="{StaticResource Brush_WindowBg}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Border BorderBrush="#333333" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="*"/>
                <!-- Content -->
                <RowDefinition Height="Auto"/>
                <!-- Status -->
            </Grid.RowDefinitions>

            <!-- 1. Header (Интегрирован в цвет фона) -->
            <Grid Grid.Row="0" Background="{StaticResource Brush_WindowBg}" MouseDown="TitleBar_MouseDown" Height="40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                    <TextBlock Text="{DynamicResource app_title}" 
                               Foreground="#888888" 
                               FontWeight="Bold" 
                               FontSize="14"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Content="⚙" Click="Settings_Click" Style="{StaticResource TitleBarButton}" ToolTip="{DynamicResource ui_settings}"/>
                    <Button Content="_" Click="Minimize_Click" Style="{StaticResource TitleBarButton}"/>
                    <Button Content="X" Click="Close_Click" Style="{StaticResource CloseButton}"/>
                </StackPanel>
            </Grid>

            <!-- 2. Main Content (Scrollable if needed, but fits mostly) -->
            <Grid Grid.Row="1" Margin="15,5,15,15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Config Card -->
                    <RowDefinition Height="*"/>
                    <!-- Log Card -->
                </Grid.RowDefinitions>

                <!-- CARD 1: CONFIGURATION -->
                <Border Grid.Row="0" Style="{StaticResource CardBorder}" Margin="0,0,0,15" Grid.IsSharedSizeScope="True">
                    <StackPanel>
                        <TextBlock Text="Configuration" FontSize="18" FontWeight="Bold" Foreground="White" Margin="0,0,0,15"/>

                        <!-- Source Folder -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" SharedSizeGroup="Labels"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{DynamicResource ui_source_dir}" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="SourceDirBox" Grid.Column="1" IsReadOnly="True" Margin="0,0,8,0" Cursor="Arrow"/>
                            <Button x:Name="SelectSourceBtn" Grid.Column="2" Content="{DynamicResource ui_choose_btn}" Click="SelectSource_Click" MinWidth="80"/>
                        </Grid>

                        <!-- Preset -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" SharedSizeGroup="Labels"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{DynamicResource ui_preset}" Style="{StaticResource FieldLabel}"/>
                            <ComboBox x:Name="PresetCombo" Grid.Column="1" SelectionChanged="Preset_SelectionChanged"/>
                        </Grid>

                        <!-- Extensions -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" SharedSizeGroup="Labels"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{DynamicResource ui_extensions}" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="ExtensionsBox" Grid.Column="1" Tag="{DynamicResource ui_extensions_prompt}"
                                     ToolTip="{DynamicResource ui_extensions_prompt}"/>
                        </Grid>

                        <!-- Ignored & Rescan -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" SharedSizeGroup="Labels"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{DynamicResource ui_ignored}" Style="{StaticResource FieldLabel}"/>
                            <TextBox x:Name="IgnoredBox" Grid.Column="1" Margin="0,0,8,0" Tag="{DynamicResource ui_ignored_prompt}"
                                     ToolTip="{DynamicResource ui_ignored_prompt}"/>
                            <Button x:Name="RescanBtn" Grid.Column="2" Content="{DynamicResource ui_rescan_btn}" Click="Rescan_Click" IsEnabled="False" MinWidth="80"/>
                        </Grid>

                        <Separator Background="#333333" Margin="0,5,0,15"/>

                        <!-- Advanced Settings -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left: Structure -->
                            <StackPanel Grid.Column="0">
                                <CheckBox x:Name="StructCb" Content="{DynamicResource ui_structure_cb}" IsChecked="False" Margin="0,0,0,10"/>
                                <CheckBox x:Name="CompactCb" Content="{DynamicResource ui_compact_structure_cb}" IsChecked="True"
                                          IsEnabled="{Binding IsChecked, ElementName=StructCb}"/>
                            </StackPanel>

                            <!-- Right: Compression -->
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="{DynamicResource ui_compression_label}" FontWeight="SemiBold" Foreground="#AAAAAA" Margin="0,0,0,5" FontSize="12"/>
                                <ComboBox x:Name="CompressionCombo" HorizontalAlignment="Stretch"/>
                            </StackPanel>
                        </Grid>

                        <!-- Merged Checkbox & Files -->
                        <Grid Margin="0,15,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <CheckBox x:Name="MergedCb" Content="Generate Merged File" IsChecked="True" VerticalAlignment="Center"/>
                            <Button x:Name="SelectFilesBtn" Grid.Column="1" Content="{DynamicResource ui_select_files_btn}" Click="SelectFiles_Click" IsEnabled="False" MinWidth="120"/>
                        </Grid>

                        <!-- Main Action Button -->
                        <Button x:Name="ConvertBtn" Content="{DynamicResource ui_convert_btn}" 
                                Style="{StaticResource AccentButton}"
                                Click="Convert_Click" IsEnabled="False" Margin="0,20,0,0"/>
                    </StackPanel>
                </Border>

                <!-- CARD 2: LOG -->
                <Border Grid.Row="1" Style="{StaticResource CardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="{DynamicResource ui_log_label}" FontWeight="Bold" Foreground="#AAAAAA" Margin="0,0,0,8"/>
                        <TextBox x:Name="LogBox" Grid.Row="1" IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                                 FontFamily="Consolas" FontSize="13" TextWrapping="Wrap" 
                                 Background="#151515" BorderThickness="0" Padding="5"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- 4. Status Bar -->
            <Grid Grid.Row="2" Background="#202020" Height="30">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusLabel" Text="{DynamicResource ui_status_ready}"
                           Foreground="#888888" VerticalAlignment="Center" Margin="15,0" FontSize="12"/>
                <ProgressBar x:Name="StatusProgressBar" Grid.Column="1" Margin="10,0,15,0" Height="4" VerticalAlignment="Center" Value="0" Maximum="1"/>
            </Grid>
        </Grid>
    </Border>
</Window>