<Window x:Class="TxtConverter.Views.AiTaskWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None" ResizeMode="CanResizeWithGrip"
        Width="850" Height="700" MinWidth="600" MinHeight="550"
        WindowStartupLocation="CenterOwner"
        Title="AI Smart Select" Background="{StaticResource Brush_WindowBg}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Border BorderBrush="#333333" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="*"/>
                <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Background="{StaticResource Brush_WindowBg}" MouseDown="TitleBar_MouseDown" Height="40">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                    <TextBlock Text="🪄 AI Smart Select" FontWeight="Bold" Foreground="#007ACC" Margin="0,0,10,0"/>
                    <TextBlock Text="(Gemini 2.0)" Foreground="#666" FontSize="12" VerticalAlignment="Center"/>
                </StackPanel>
                <Button Style="{StaticResource CloseButton}" HorizontalAlignment="Right" Click="Close_Click" Content="X" WindowChrome.IsHitTestVisibleInChrome="True"/>
            </Grid>

            <!-- Content Area -->
            <Grid Grid.Row="1" Margin="15">
                <TabControl Background="Transparent" BorderThickness="0">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border Name="Border" BorderThickness="0,0,0,2" BorderBrush="Transparent" Margin="0,0,15,0" Padding="12,8">
                                            <ContentPresenter x:Name="ContentSite" ContentSource="Header"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="BorderBrush" Value="#007ACC" />
                                                <Setter Property="Foreground" Value="White" />
                                                <Setter Property="FontWeight" Value="SemiBold" />
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="False">
                                                <Setter Property="Foreground" Value="#888888" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>

                    <!-- TAB 1: TASK INPUT & CONFIG -->
                    <TabItem Header="Task &amp; Config">
                        <Grid Margin="0,15,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Override Settings -->
                                <RowDefinition Height="Auto"/>
                                <!-- Task Title -->
                                <RowDefinition Height="*"/>
                                <!-- Input Box -->
                                <RowDefinition Height="Auto"/>
                                <!-- Footer -->
                            </Grid.RowDefinitions>

                            <!-- 1. Override Settings -->
                            <Border Grid.Row="0" Background="#202021" BorderBrush="#333" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,15">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="20"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.ColumnSpan="5" Text="Model Settings (Override for this request)" Foreground="#888" FontSize="11" Margin="0,0,0,5" FontWeight="Bold"/>

                                    <!-- Model -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Model:" VerticalAlignment="Center" Foreground="#CCC" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="ModelOverrideBox" Grid.Row="1" Grid.Column="1" 
                                              IsEditable="True"
                                              Background="#151515" Foreground="White" BorderBrush="#444" Padding="5"/>

                                    <!-- Budget -->
                                    <TextBlock Grid.Row="1" Grid.Column="3" Text="Thinking Budget:" VerticalAlignment="Center" Foreground="#CCC" Margin="0,0,10,0"/>
                                    <TextBox x:Name="BudgetOverrideBox" Grid.Row="1" Grid.Column="4" TextAlignment="Center" Background="#151515" Foreground="White" BorderBrush="#444" Padding="5"/>
                                </Grid>
                            </Border>

                            <!-- 2. Task Title -->
                            <StackPanel Grid.Row="1" Margin="0,0,0,5">
                                <TextBlock Text="Describe your task:" Foreground="White" FontWeight="SemiBold" FontSize="15"/>
                            </StackPanel>

                            <!-- 3. Input Box -->
                            <TextBox x:Name="PromptBox" Grid.Row="2" 
                                     TextWrapping="Wrap" AcceptsReturn="True" 
                                     VerticalScrollBarVisibility="Visible"
                                     Background="#151515" Foreground="White" 
                                     BorderBrush="#333333" Padding="10"
                                     FontSize="14"
                                     Tag="Example: I need to fix the player movement logic."/>

                            <!-- 4. Footer -->
                            <Grid Grid.Row="3" Margin="0,15,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock x:Name="StatusText" Text="Ready to analyze." Foreground="#888" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,0,10,0"/>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="Cancel" Click="Close_Click" Width="90" Margin="0,0,10,0" Background="Transparent" BorderBrush="#444"/>
                                    <Button x:Name="AnalyzeBtn" Content="🚀 Analyze Project" Click="Analyze_Click" Style="{StaticResource AccentButton}" Width="160"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <!-- TAB 2: REQUEST DEBUG -->
                    <TabItem Header="Sent Context (Debug)">
                        <Grid Margin="0,10,0,0">
                            <TextBox x:Name="RequestBox" IsReadOnly="True" 
                                     TextWrapping="Wrap" VerticalScrollBarVisibility="Visible"
                                     Background="#111" Foreground="#AACCFF" FontFamily="Consolas" FontSize="13"
                                     BorderThickness="0" Padding="10"/>
                        </Grid>
                    </TabItem>

                    <!-- TAB 3: RESPONSE DEBUG -->
                    <TabItem Header="AI Response / Thoughts">
                        <Grid Margin="0,10,0,0">
                            <TextBox x:Name="ResponseBox" IsReadOnly="True" 
                                     TextWrapping="Wrap" VerticalScrollBarVisibility="Visible"
                                     Background="#111" Foreground="#AAFFAA" FontFamily="Consolas" FontSize="13"
                                     BorderThickness="0" Padding="10"/>
                        </Grid>
                    </TabItem>
                </TabControl>

                <!-- Loading Overlay -->
                <Grid x:Name="LoadingOverlay" Visibility="Collapsed" Background="#D0000000">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBlock Text="AI IS THINKING..." Foreground="White" FontWeight="Bold" FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                        <ProgressBar IsIndeterminate="True" Width="300" Height="6"/>
                        <TextBlock x:Name="LoadingStatus" Text="Building Context..." Foreground="#CCC" FontSize="14" Margin="0,20,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>