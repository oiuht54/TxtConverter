@echo off
:: Устанавливаем кодировку UTF-8 для корректного отображения имен файлов в консоли
chcp 65001 > nul

echo ========================================================
echo =  Супер-копировщик файлов проекта (.java, .xml, .css, .fxml...)  =
echo ========================================================
echo.

:: --- НАСТРОЙКИ ---
:: Папка, откуда ищем файлы. Точка (.) означает текущую папку (корень проекта).
set "SOURCE_DIR=."
:: Папка, куда будут скопированы все файлы.
set "DEST_DIR=java-as-txt"
:: --- КОНЕЦ НАСТРОЕК ---

:: Создаем папку назначения, если ее еще нет
if not exist "%DEST_DIR%" (
    echo Создание папки: %DEST_DIR%
    mkdir "%DEST_DIR%"
)

echo Поиск файлов в: %SOURCE_DIR%
echo Копирование в: %DEST_DIR%
echo.

:: =========================================================================
:: Основной цикл. Рекурсивно (-r) ищет в папке SOURCE_DIR все файлы
:: по маскам: *.java, *.xml, *.fxml, *.css, *.properties
:: =========================================================================
for /r "%SOURCE_DIR%" %%F in (*.java, *.xml, *.fxml, *.css, *.properties) do (
    
    :: Это хитрая проверка, чтобы скрипт не начал копировать файлы из папки назначения
    :: Он проверяет, что путь к файлу НЕ начинается с пути к папке назначения
    echo "%%~fF" | findstr /b /i /c:"%DEST_DIR%" >nul || (
    
        rem --- Правила конвертации и копирования ---

        :: Если это файл version.properties, конвертируем в version.properties.txt
        if /i "%%~nxF"=="version.properties" (
            echo Конвертация: "%%~nxF" --^> "%%~nxF.txt"
            copy "%%~fF" "%DEST_DIR%\%%~nxF.txt" > nul
        ) else (

            :: Если это .java или .fxml файл, конвертируем в .txt
            if /i "%%~xF"==".java" (
                echo Конвертация: "%%~nxF" --^> "%%~nF.txt"
                copy "%%~fF" "%DEST_DIR%\%%~nF.txt" > nul
            )
            if /i "%%~xF"==".fxml" (
                echo Конвертация: "%%~nxF" --^> "%%~nF.txt"
                copy "%%~fF" "%DEST_DIR%\%%~nF.txt" > nul
            )

            :: Если это .xml или .css файл, просто копируем как есть
            if /i "%%~xF"==".xml" (
                echo Копирование:  "%%~nxF"
                copy "%%~fF" "%DEST_DIR%\%%~nxF" > nul
            )
            if /i "%%~xF"==".css" (
                echo Копирование:  "%%~nxF"
                copy "%%~fF" "%DEST_DIR%\%%~nxF" > nul
            )
        )
    )
)

echo.
echo ========================================================
echo Готово! Все необходимые файлы обработаны.
echo ========================================================
echo Нажмите любую клавишу для выхода...
pause > null